<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Платформер с кнопками</title>
<style>
  body, html {
    margin:0; padding:0; overflow:hidden; background:#222; color:#eee; font-family:sans-serif;
    user-select:none;
    -webkit-user-select:none;
    -ms-user-select:none;
  }
  #gameCanvas {
    display:block;
    background: linear-gradient(to top, #87ceeb, #f0f8ff);
    margin:0 auto;
    border: 3px solid #333;
    border-radius: 12px;
  }
  #controls {
    position: fixed;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    width: 320px;
    max-width: 90vw;
    display: flex;
    justify-content: space-between;
    gap: 10px;
  }
  .btn {
    background: #0078d7;
    border-radius: 12px;
    flex: 1;
    padding: 20px 0;
    text-align: center;
    font-weight: 700;
    font-size: 1.2rem;
    user-select:none;
    touch-action: none;
    color: white;
    box-shadow: 0 4px 10px #005fa3;
    transition: background 0.2s;
    -webkit-tap-highlight-color: transparent;
  }
  .btn:active, .btn.pressed {
    background: #005fa3;
    box-shadow: 0 2px 6px #003a66 inset;
  }
</style>
</head>
<body>

<canvas id="gameCanvas" width="640" height="360"></canvas>

<div id="controls">
  <div class="btn" id="btn-left">⬅️</div>
  <div class="btn" id="btn-down">⬇️</div>
  <div class="btn" id="btn-jump">⏫</div>
  <div class="btn" id="btn-right">➡️</div>
</div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  const width = canvas.width;
  const height = canvas.height;

  // Игрок
  const player = {
    x: 50,
    y: 0,
    width: 40,
    height: 60,
    color: '#e63946',
    dy: 0,
    dx: 0,
    speed: 3,
    jumpForce: 12,
    onGround: false,
  };

  // Гравитация
  const gravity = 0.6;

  // Платформы
  const platforms = [
    {x: 0, y: height - 40, width: width, height: 40},  // пол
    {x: 150, y: 260, width: 120, height: 15},
    {x: 320, y: 220, width: 100, height: 15},
    {x: 480, y: 180, width: 120, height: 15},
    {x: 600, y: 140, width: 40, height: 15},
  ];

  // Управление
  const keys = {
    left: false,
    right: false,
    up: false,
    down: false,
  };

  // Обработка клавиш с клавиатуры
  window.addEventListener('keydown', e => {
    if (e.repeat) return;
    switch(e.code){
      case 'ArrowLeft': keys.left = true; break;
      case 'ArrowRight': keys.right = true; break;
      case 'ArrowUp': keys.up = true; break;
      case 'ArrowDown': keys.down = true; break;
      case 'Space': keys.up = true; break;
    }
  });
  window.addEventListener('keyup', e => {
    switch(e.code){
      case 'ArrowLeft': keys.left = false; break;
      case 'ArrowRight': keys.right = false; break;
      case 'ArrowUp': keys.up = false; break;
      case 'ArrowDown': keys.down = false; break;
      case 'Space': keys.up = false; break;
    }
  });

  // Обработка нажатий по кнопкам (для тач)
  function setBtnHandlers(id, keyName){
    const btn = document.getElementById(id);
    btn.addEventListener('touchstart', e => {
      e.preventDefault();
      keys[keyName] = true;
      btn.classList.add('pressed');
    }, {passive:false});
    btn.addEventListener('touchend', e => {
      e.preventDefault();
      keys[keyName] = false;
      btn.classList.remove('pressed');
    });
    btn.addEventListener('mousedown', e => {
      e.preventDefault();
      keys[keyName] = true;
      btn.classList.add('pressed');
    });
    btn.addEventListener('mouseup', e => {
      e.preventDefault();
      keys[keyName] = false;
      btn.classList.remove('pressed');
    });
    btn.addEventListener('mouseleave', e => {
      keys[keyName] = false;
      btn.classList.remove('pressed');
    });
  }
  setBtnHandlers('btn-left', 'left');
  setBtnHandlers('btn-right', 'right');
  setBtnHandlers('btn-jump', 'up');
  setBtnHandlers('btn-down', 'down');

  // Функция проверки коллизий с платформами
  function checkCollision(px, py, pw, ph, platform){
    return px < platform.x + platform.width &&
           px + pw > platform.x &&
           py < platform.y + platform.height &&
           py + ph > platform.y;
  }

  // Игровой цикл
  function update(){
    // Горизонтальное движение
    if(keys.left){
      player.dx = -player.speed;
    } else if(keys.right){
      player.dx = player.speed;
    } else {
      player.dx = 0;
    }

    // Прыжок
    if(keys.up && player.onGround){
      player.dy = -player.jumpForce;
      player.onGround = false;
    }

    // Гравитация
    player.dy += gravity;

    // Обновление позиции
    player.x += player.dx;
    player.y += player.dy;

    // Границы экрана
    if(player.x < 0) player.x = 0;
    if(player.x + player.width > width) player.x = width - player.width;
    if(player.y + player.height > height){
      player.y = height - player.height;
      player.dy = 0;
      player.onGround = true;
    }

    // Проверка столкновений с платформами
    player.onGround = false;
    for(let platform of platforms){
      if(checkCollision(player.x, player.y + player.dy, player.width, player.height, platform)){
        if(player.dy > 0){ // падает вниз на платформу
          player.y = platform.y - player.height;
          player.dy = 0;
          player.onGround = true;
        } else if(player.dy < 0){ // прыжок вверх в платформу
          player.y = platform.y + platform.height;
          player.dy = 0;
        }
      }
      // Боковые столкновения (упрощённо)
      if(checkCollision(player.x + player.dx, player.y, player.width, player.height, platform)){
        if(player.dx > 0){
          player.x = platform.x - player.width;
        } else if(player.dx < 0){
          player.x = platform.x + platform.width;
        }
      }
    }
  }

  function draw(){
    // Очистка
    ctx.clearRect(0, 0, width, height);

    // Рисуем фон (градиент уже в css, но можно чуть дополнить)
    ctx.fillStyle = '#a0d8f7';
    ctx.fillRect(0, 0, width, height);

    // Платформы
    ctx.fillStyle = '#264653';
    for(let p of platforms){
      ctx.fillRect(p.x, p.y, p.width, p.height);
    }

    // Игрок
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);
  }

  function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
  }

  loop();

})();
</script>

</body>
</html>