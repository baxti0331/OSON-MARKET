<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OSON MARKET</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0;font-family:sans-serif;}
  body{background:#f9f9f9;padding:15px;color:#222;}
  header{text-align:center;margin-bottom:20px;}
  main{max-width:1200px;margin:0 auto;display:flex;flex-wrap:wrap;gap:20px;}
  section{background:#fff;padding:15px;border-radius:12px;box-shadow:0 3px 8px rgba(0,0,0,0.1);}
  #products{flex:3 1 600px;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px;}
  .product-card{border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.1);padding:15px;display:flex;flex-direction:column;transition:box-shadow 0.3s;}
  .product-card:hover{box-shadow:0 10px 20px rgba(0,0,0,0.15);}
  .product-card img{width:100%;border-radius:10px;aspect-ratio:1/1;object-fit:cover;margin-bottom:12px;}
  .product-card h3{font-weight:600;margin-bottom:8px;font-size:1.1rem;flex-grow:1;}
  .product-card p{color:#0078d7;font-weight:700;margin-bottom:12px;}
  .product-card button{background:#0078d7;color:#fff;border:none;border-radius:10px;padding:10px;font-weight:700;cursor:pointer;transition:background 0.3s;}
  .product-card button:hover{background:#005fa3;}
  #cart{flex:1 1 280px;display:flex;flex-direction:column;max-height:600px;}
  #cart h2{margin-bottom:10px;font-weight:700;}
  #cart-list{flex-grow:1;overflow-y:auto;list-style:none;padding-right:5px;}
  .cart-item{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;}
  .cart-item span{flex-grow:1;overflow-wrap:anywhere;}
  .cart-item input{width:50px;margin:0 10px;padding:4px;border-radius:6px;border:1px solid #ccc;text-align:center;}
  .cart-item button{background:none;border:none;color:#cc0000;font-size:1.4rem;cursor:pointer;user-select:none;padding:0 5px;}
  #cart-total{font-weight:700;font-size:1.2rem;text-align:right;margin:10px 0;color:#0078d7;}
  #checkoutBtn{background:#28a745;color:#fff;border:none;border-radius:12px;padding:15px;font-weight:700;cursor:pointer;transition:background 0.3s;}
  #checkoutBtn:hover{background:#1e7e34;}
  #adminPanel{flex-basis:100%;margin-top:30px;}
  #adminPanel h2{margin-bottom:10px;}
  #adminForm label{display:block;margin-bottom:6px;font-weight:600;}
  #adminForm input[type="text"], #adminForm input[type="number"], #adminForm select, #adminForm input[type="file"]{
    width:100%;padding:8px 12px;margin-bottom:12px;border-radius:6px;border:1px solid #ccc;
  }
  #adminForm button{
    background:#0078d7;color:#fff;border:none;padding:12px 20px;border-radius:10px;cursor:pointer;font-weight:700;transition:background 0.3s;
  }
  #adminForm button:hover{background:#005fa3;}
  #notification{
    position:fixed;top:20px;right:20px;background:#28a745;color:#fff;padding:12px 20px;border-radius:10px;box-shadow:0 3px 8px rgba(0,0,0,0.2);
    display:none; z-index:1000; font-weight:700;
  }
  #authPanel{
    flex-basis:100%;
    background:#e9e9e9;
    padding:15px;
    border-radius:12px;
    margin-bottom:20px;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
  }
  #authPanel input, #authPanel button{
    padding:10px;
    margin:5px 0;
    width:100%;
    border-radius:6px;
    border:1px solid #ccc;
  }
  #authPanel button{
    background:#0078d7;
    color:#fff;
    border:none;
    cursor:pointer;
    font-weight:700;
  }
  #authPanel button:hover{
    background:#005fa3;
  }
  #logoutBtn{
    background:#cc0000;
    color:#fff;
    border:none;
    border-radius:10px;
    padding:10px 20px;
    font-weight:700;
    cursor:pointer;
    margin-top:10px;
  }
  #logoutBtn:hover{
    background:#990000;
  }
  @media(max-width:768px){
    main{flex-direction:column;}
    #cart,#products{max-width:100%;}
  }
</style>
</head>
<body>
<header>
  <h1>OSON MARKET</h1>
</header>

<main>
  <section id="authPanel">
    <div id="authForms">
      <h2>Авторизация</h2>
      <input type="text" id="loginInput" placeholder="Логин" autocomplete="username" />
      <input type="password" id="passwordInput" placeholder="Пароль" autocomplete="current-password" />
      <button id="loginBtn">Войти</button>
      <p style="text-align:center;margin:10px 0;">или</p>
      <input type="text" id="regLogin" placeholder="Новый логин" autocomplete="username" />
      <input type="password" id="regPassword" placeholder="Новый пароль" autocomplete="new-password" />
      <button id="registerBtn">Зарегистрироваться</button>
    </div>
    <div id="userInfo" style="display:none;">
      <p>Вы вошли как: <strong><span id="userNameDisplay"></span></strong></p>
      <button id="logoutBtn">Выйти</button>
    </div>
  </section>

  <section id="products" style="display:none;"></section>

  <section id="cart" style="display:none;">
    <h2>Корзина</h2>
    <ul id="cart-list"><li>Корзина пуста</li></ul>
    <div id="cart-total">Итого: 0 UZS</div>
    <button id="checkoutBtn">Оформить заказ</button>
  </section>

  <section id="adminPanel" style="display:none;">
    <h2>Панель администратора</h2>
    <form id="adminForm">
      <label for="prodName">Название товара</label>
      <input type="text" id="prodName" required />
      <label for="prodPrice">Цена (UZS)</label>
      <input type="number" id="prodPrice" min="1" required />
      <label for="prodCategory">Категория</label>
      <select id="prodCategory" required>
        <option value="">Выберите категорию</option>
        <option value="sport">Спорт</option>
        <option value="accessory">Аксессуары</option>
      </select>
      <label for="prodImage">Фото товара</label>
      <input type="file" id="prodImage" accept="image/*" required />
      <button type="submit">Добавить товар</button>
    </form>
  </section>
</main>

<div id="notification"></div>

<script>
const lsKey = "osonMarketProducts";
const cartKey = "osonMarketCart";
const usersKey = "osonMarketUsers";
const sessionKey = "osonMarketSession";

let productsData = JSON.parse(localStorage.getItem(lsKey)) || [
  {id:1,name:"Спортивная футболка",price:99000,category:"sport",img:"https://via.placeholder.com/300?text=Футболка"},
  {id:2,name:"Шорты тренировочные",price:79000,category:"sport",img:"https://via.placeholder.com/300?text=Шорты"},
  {id:3,name:"Рюкзак городской",price:159000,category:"accessory",img:"https://via.placeholder.com/300?text=Рюкзак"},
  {id:4,name:"Бутылка для воды",price:49000,category:"accessory",img:"https://via.placeholder.com/300?text=Бутылка"}
];
let cart = JSON.parse(localStorage.getItem(cartKey)) || [];
let users = JSON.parse(localStorage.getItem(usersKey)) || [];
let sessionUser = JSON.parse(localStorage.getItem(sessionKey)) || null;

const productsContainer=document.getElementById("products");
const cartList=document.getElementById("cart-list");
const cartTotal=document.getElementById("cart-total");
const checkoutBtn=document.getElementById("checkoutBtn");
const adminForm=document.getElementById("adminForm");
const notification=document.getElementById("notification");

const authPanel=document.getElementById("authPanel");
const authForms=document.getElementById("authForms");
const userInfo=document.getElementById("userInfo");
const userNameDisplay=document.getElementById("userNameDisplay");
const loginInput=document.getElementById("loginInput");
const passwordInput=document.getElementById("passwordInput");
const loginBtn=document.getElementById("loginBtn");
const regLogin=document.getElementById("regLogin");
const regPassword=document.getElementById("regPassword");
const registerBtn=document.getElementById("registerBtn");
const logoutBtn=document.getElementById("logoutBtn");
const adminPanel=document.getElementById("adminPanel");

function showNotification(msg){
  notification.textContent = msg;
  notification.style.display = "block";
  setTimeout(() => notification.style.display = "none", 3000);
}

function saveProducts(){
  localStorage.setItem(lsKey, JSON.stringify(productsData));
}
function saveCart(){
  localStorage.setItem(cartKey, JSON.stringify(cart));
}
function saveUsers(){
  localStorage.setItem(usersKey, JSON.stringify(users));
}
function saveSession(){
  localStorage.setItem(sessionKey, JSON.stringify(sessionUser));
}

function renderProducts(){
  productsContainer.innerHTML = "";
  productsData.forEach(prod => {
    const card = document.createElement("div");
    card.className = "product-card";
    card.innerHTML = `
      <img src="${prod.img}" alt="${prod.name}" />
      <h3>${prod.name}</h3>
      <p>${prod.price.toLocaleString()} UZS</p>
      <button data-id="${prod.id}">Добавить в корзину</button>
    `;
    productsContainer.appendChild(card);
  });
  productsContainer.querySelectorAll("button").forEach(btn=>{
    btn.onclick = () => {
      const id = +btn.dataset.id;
      addToCart(id);
    };
  });
}

function renderCart(){
  cartList.innerHTML = "";
  if(cart.length === 0){
    cartList.innerHTML = "<li>Корзина пуста</li>";
    cartTotal.textContent = "Итого: 0 UZS";
    checkoutBtn.disabled = true;
    return;
  }
  checkoutBtn.disabled = false;
  let sum = 0;
  cart.forEach(item => {
    const prod = productsData.find(p => p.id === item.id);
    const li = document.createElement("